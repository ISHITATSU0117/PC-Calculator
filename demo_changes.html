<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Changes Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        h2 { color: #1976d2; }
        .code {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th { background: #1976d2; color: white; }
    </style>
</head>
<body>
    <h1>修正内容のデモ</h1>
    
    <div class="section">
        <h2>1. 計算ロジックの修正</h2>
        <p><strong>問題:</strong> 時刻データが不正な場合、計算が静かに失敗していました。</p>
        <p><strong>修正:</strong> NaN検証を追加し、不正なデータを検出してエラーメッセージを出力します。</p>
        
        <h3>修正前:</h3>
        <div class="code">
const hours = parseInt(parts[0]);
const minutes = parseInt(parts[1]);
const seconds = parseFloat(parts[2]);
return hours * 3600 + minutes * 60 + seconds;
        </div>
        <p class="error">❌ 不正な時刻データがあるとNaNが返され、計算が失敗</p>
        
        <h3>修正後:</h3>
        <div class="code">
const hours = parseInt(parts[0]);
const minutes = parseInt(parts[1]);
const seconds = parseFloat(parts[2]);

// NaNチェック
if (isNaN(hours) || isNaN(minutes) || isNaN(seconds)) {
    console.error('時刻変換エラー: 無効な数値', timeStr);
    return null;
}

return hours * 3600 + minutes * 60 + seconds;
        </div>
        <p class="success">✅ 不正なデータを検出し、エラーメッセージを出力</p>
    </div>
    
    <div class="section">
        <h2>2. ゼッケン番号の並び順を逆転</h2>
        <p><strong>要件:</strong> 結果閲覧ページで若番が下に来るようにする。</p>
        
        <h3>修正前（昇順）:</h3>
        <table>
            <tr><th>ゼッケン</th><th>PC1 START</th></tr>
            <tr><td>1</td><td>14:27:56.28</td></tr>
            <tr><td>2</td><td>14:33:53.65</td></tr>
            <tr><td>5</td><td>14:34:32.13</td></tr>
            <tr><td>7</td><td>14:35:05.88</td></tr>
            <tr><td>9</td><td>14:35:39.08</td></tr>
        </table>
        <p class="error">❌ 若番(1, 2)が上に表示される</p>
        
        <h3>修正後（降順）:</h3>
        <table>
            <tr><th>ゼッケン</th><th>PC1 START</th></tr>
            <tr><td>9</td><td>14:35:39.08</td></tr>
            <tr><td>7</td><td>14:35:05.88</td></tr>
            <tr><td>5</td><td>14:34:32.13</td></tr>
            <tr><td>2</td><td>14:33:53.65</td></tr>
            <tr><td>1</td><td>14:27:56.28</td></tr>
        </table>
        <p class="success">✅ 若番(1, 2)が下に表示される</p>
        
        <h3>コード変更:</h3>
        <div class="code">
// 修正前
return aNum - bNum;  // 昇順

// 修正後
return bNum - aNum;  // 降順に変更
        </div>
    </div>
    
    <div class="section">
        <h2>テスト結果</h2>
        <div id="test-results"></div>
    </div>
    
    <script>
        // Run basic tests
        function timeToSeconds(timeStr) {
            try {
                const parts = timeStr.split(':');
                if (parts.length !== 3) return null;

                const hours = parseInt(parts[0]);
                const minutes = parseInt(parts[1]);
                const seconds = parseFloat(parts[2]);

                // NaNチェック
                if (isNaN(hours) || isNaN(minutes) || isNaN(seconds)) {
                    return null;
                }

                return hours * 3600 + minutes * 60 + seconds;
            } catch (error) {
                return null;
            }
        }
        
        const tests = [
            { input: '14:27:56.28', expected: 52076.28, desc: '正常な時刻' },
            { input: ':10:56', expected: null, desc: '空の時間' },
            { input: '14::56', expected: null, desc: '空の分' },
            { input: '14:10:', expected: null, desc: '空の秒' }
        ];
        
        let html = '<ul>';
        tests.forEach(test => {
            const result = timeToSeconds(test.input);
            const success = result === test.expected;
            const icon = success ? '✅' : '❌';
            html += `<li>${icon} ${test.desc}: "${test.input}" → ${result} (expected: ${test.expected})</li>`;
        });
        
        // Test sorting
        const bibs = [{bibNumber: '5'}, {bibNumber: '1'}, {bibNumber: '9'}];
        bibs.sort((a, b) => parseInt(b.bibNumber) - parseInt(a.bibNumber));
        const sortResult = bibs.map(b => b.bibNumber).join(', ');
        const sortSuccess = sortResult === '9, 5, 1';
        html += `<li>${sortSuccess ? '✅' : '❌'} ソート順: ${sortResult} (expected: 9, 5, 1)</li>`;
        
        html += '</ul>';
        document.getElementById('test-results').innerHTML = html;
    </script>
</body>
</html>
